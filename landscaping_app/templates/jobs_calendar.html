{% extends "base.html" %}
{% block title %}Calendar - Landscaping App{% endblock %}
{% block head_extra %}
<style>
    .cal-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .cal-table th, .cal-table td { border: 1px solid var(--border); padding: 8px; vertical-align: top; min-height: 80px; }
    .cal-table th { background: #f0f5f0; font-size: 0.85rem; }
    .cal-day { min-height: 90px; }
    .cal-day-num { font-weight: 700; color: var(--muted); margin-bottom: 4px; }
    .cal-job { font-size: 0.8rem; margin-bottom: 4px; }
    .cal-job a { display: block; padding: 2px 6px; background: #e8f3ed; border-radius: 6px; color: inherit; text-decoration: none; }
    .cal-job a:hover { background: var(--primary); color: #fff; }
    .cal-empty { color: #ccc; }
</style>
{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Calendar</h1>
    <div>
        <a href="/jobs/calendar?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-outline-secondary">Previous</a>
        <span class="mx-3 fw-bold">{{ month_name }} {{ year }}</span>
        <a href="/jobs/calendar?year={{ next_year }}&month={{ next_month }}" class="btn btn-outline-secondary">Next</a>
    </div>
</div>
<p class="mb-3"><a href="/jobs">List view</a></p>
<table class="table cal-table">
    <thead>
        <tr>
            <th>Monday</th>
            <th>Tuesday</th>
            <th>Wednesday</th>
            <th>Thursday</th>
            <th>Friday</th>
            <th>Saturday</th>
            <th>Sunday</th>
        </tr>
    </thead>
    <tbody>
        {% for week in calendar_grid %}
        <tr>
            {% for day in week %}
            <td class="cal-day">
                {% if day %}
                <div class="cal-day-num">{{ day }}</div>
                {% set date_key = '%04d-%02d-%02d'|format(year, month, day) %}
                {% for job in jobs_by_date.get(date_key, []) %}
                <div class="cal-job">
                    <a href="/jobs/{{ job.id }}" title="{{ job.client_name }}">{{ job.description[:25] }}{% if job.description|length > 25 %}…{% endif %}</a>
                </div>
                {% endfor %}
                {% else %}
                <span class="cal-empty">—</span>
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
